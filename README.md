
# BeautifulSoup的基础应用

BeautifulSoup是一个用于从HTML和XML文件中提取数据的Python库。BeautifulSoup提供了一些简单的函数，用于实现导航、搜索、修改分析树等功能。

## 解析HTML

通过BeautifulSoup库进行HTML的解析，具体步骤如下。

1. 导入bs4库，然后创建一个模拟的HTML代码的字符串，代码如下[9.1.py](9.1.py)
2. 创建BeautifulSoup对象，并指定解析器为lxml，最后通过打印的方式将解析的HTML代码显示在控制台中，代码如第二段。

# 获取标签内容

使用BeautifulSoup可以直接调用标签的名称，然后再调用对应的string属性，便可以获取标签内的文本信息。在单个标签结构非常清晰的情下，使用这种方式提取标签信息的速度是非常快速的。

## 获取标签对应的代码

在获取标签对应的代码时，可以直接调用对应的标签名称，如```<head>、<body>、<title>```以及```<p>```标签。代码如下[9.2.py](9.2.py)

在打印```<p>```标签对应的代码时，发现只打印了第一个```<p>```标签内容，这说明当有多个标签时，该选择方式只会获取第一个标签中的内容，其他后面的标签将被忽略。

除了通过指定标签名称的方式获取标签内容以外，还可以使用name属性获取标签的名称。代码如后半段。

# 获取标签属性

## 不去标签属性

每个标签都会含有多个属性，如class或者id等。如果已经选择了一个指定的标签名称，那么只需要调用attrs即可获取这个标签的所有属性。代码[9.3.py](9.1.py)

在以上的运行结果中可以发现，attrs的返回结果为字典类型，字典中的元素分别是属名称与对应的值。所以在attrs后面添加方括号（\[\]）并在方括号内添加属性名称即可获取属性对应的值。代码在后半段。

在获取标签中指定属性对应的值时，除了使用以上的方法以外，还可以不写attrs，直接在标签后面以中括号的形式直接添加属性名称，来获取对应的值。代码如最后一段。

## 获取标签内的文本

实现获取标签内文本的内容是非常简单的，只需要在标签名称后面添加string属性即可。代码

```python
print('title标签所包含的文本内容为：',soup.title.string)
print('h3标签所包含的文本内容为：',soup.h3.string)
```

## 嵌套获取标签内容

HTML代码中的每个标签都有出现嵌套的可能，而使用BeautifulSoup获取每个标签内容时，可以通过“.”直接获取下一个标签中的内容。代码[9.4.py](9.4.py)

从运行结果可以看出，在获取head与其内部的title标签内容时，数据类型均为“```<class 'bs4.element.Tag'>```”，也就是说在Tag类型的基础上可以获取当前标签的子标签内容，这样的获取方式叫做嵌套获取标签内容。

## 关联获取

在获取标签内容时，不一定都能做到一步获取指定标签中的内容，很多时候需要先确认某一个标签，然后以该标签为中心获取对应的子标签、子孙标签、父标签以及兄弟标签。

1. 获取子标签
在获取某标签下面所有子标签时，可以使用contents或children属性来实现。其中，contents所返回的是一个列表，在这个列表中每个元素都是一个子标签内容；children所返回的则是一个“list_iterator”类型的可迭代内容。代码[9.5.py](9.5.py)
从运行结果中可以看出通过head.contents所获取的所有子标签中有三个换行符号\\n以及两个子标题(title与meta)对应的所有内容；通过head.children所获取的则是一个“list_iterator”可迭代对象，如果需要获取该对象中的所有内容，可以直接将其转换为list类型或者通过for循环遍历的方式获取。代码见第二段

2. 获取子孙标签
在获取某标签下面所有的子孙标签时，可以使用descendants属性来实现，该属性会返回一个generator对象，获取该对象中所有内容时，童颜可以直接将其转换为list类型或者通过for循环遍历的方式进行获取。这里以for循环遍历的方式为例。代码[9.6.py](9.6.py)

3. 获取父标签
获取父标签有两种方式，一种是通过parent属性直接获取指定标签的父标签内容，另一种是通过parents属性获取指定标签的父标签及以上(祖先标签)内容，只是parentd属性会返回一个generator对象。获取该对象中的所有内容时，同样可以直接将其转换为list类型或者通过for寻喜欢遍历的方式进行获取。这里以for循环遍历的方式为例，获取父标签及祖先标签内容。代码[9.7.py](9.7.py)
从运行结果中可以看出，parents属性所获取父标签及祖先标签的顺序为head、html、document，随后的document表示文档对象，是整个HTML文档，也是BeautifulSoup对象。

4. 获取兄弟标签
兄弟标签也就是同级标签，表示在同一级标签内的所有子标签间的关系。在一段HTML代码中，获取第一个```<p>```标签的下一个```<div>```兄弟标签时，可以使用next_sibling属性；获取当前```<div>```标签的上一个兄弟标签```<p>```时，可以使用previous_sibling属性。通过这两个属性获取兄弟标签时，如果两个标签之间含有换行符(\n)，空字符或者其他文本内容时，将返回这些文本标签。代码[9.8.py](9.8.py)
如果像获取当前标签后面的所有兄弟标签时，可以使用next_siblings属性；如果像获取当前标签前面的所有兄弟标签时，可以使用previous_siblings属性。通过这两个属性所获取的标签都将以generator(可迭代对象)的形式进行返回。在获取标签内容时，同样可以直接将其转换为list类型或者通过for循环遍历的方式进行获取，这里转换为list类型，代码在后半段

# 利用方法获取内容

在HTML代码中获取比较复杂的内容时，可以用find_all()方法与find()方法，调用这些方法，然后传入指定的参数即可灵活的获取标签中的内容。

## find_all()方法

BeautifulSoup提供了一个find_all()方法，该方法用于获取所有符合条件的内容。语法格式如下：
```find_all(name=None,attrs={},recurive=True,text=None,limit=None,**kwargs)```

在find_all()方法中，常用参数是name、attrs以及text，下面具体介绍

1. name参数
name参数用来指定标签名称，指定该参数后将返回一个可迭代对象，所有符合条件的内容均为对向中的一个元素。代码[9.9.py](9.9.py)。使用bs4.element.ResultSet类型获取的数据与Python中的列表类似，如果想获取可以迭代对象中的某条数据，可以使用切片的方式进行获取，如获取所有```<p>```标签中的第一个元素，代码如后半段。
因为bs4.element.ResultSet数据中的每一个元素都是bs4.element.Tag类型，所以可以直接对某一个元素进行嵌套获取。代码在最后一段。

2. attrs参数
attrs参数表示通过指定属性进行数据获取工作，在填写attrs参数时，默认情况下需要填写**字典**类型的参数值，但也可以通过赋值的方式填写参数。代码[9.10.py](9.10.py)

3. text参数
指定text参数可以获取标签中的文本，该参数可以是字符串或者正则表达式的对象。代码[9.11.py](9.11.py)

## find()方法

利用find_all()方法可以获取所有符合条件的标签内容，而利用find()方法只能获取第一个匹配的标签内容，代码[9.12.py](9.12.py)

## 其他方法

见表格

| 方式名称                  | 描述                                         |
| ------------------------ | -------------------------------------------- |
| find_patenr()            | 获取父标签内容                               |
| find_patents()           | 获取所有祖先标签内容                         |
| find_next_sibling()      | 获取后面第一个兄弟标签的内容                 |
| find_next_siblings()     | 获取后面所有兄弟标签的内容                   |
| find_previous_sibling()  | 获取前面第一个兄弟标签                       |
| find_previous_siblings() | 获取前面所有的兄弟标签                       |
| find_next()              | 获取当前标签的下一个第一个符合条件的标签内容 |
| find_all_next()          | 获取当前标签的下一个所有符合条件的内容       |
| find_previous()          | 获取第一个符合条件的标签内容                 |
| find_all_previous()      | 获取所有符合条件的标签内容                   |

# CSS选择器

